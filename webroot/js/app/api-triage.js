/*! For license information please see api-triage.js.LICENSE.txt */
(()=>{"use strict";var e,t,r,s={4029:(e,t,r)=>{var s=r(6540),n=r(961);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},i.apply(null,arguments)}const a=s.createContext({user:null,users:null,roles:null,rememberMeOptions:{},resources:null,resource:null,shareResources:null,selectedResources:null,selectedUser:null,folders:null,resourceCommentId:null,mustRefreshComments:!1,siteSettings:null,userSettings:null,onCheckIsAuthenticatedRequested:null});function o(e){return class extends s.Component{render(){return s.createElement(a.Consumer,null,(t=>s.createElement(e,i({context:t},this.props))))}}}const l=a;class c{setBaseUrl(e){if(!e)throw new TypeError("ApiClientOption baseUrl is required.");if("string"==typeof e)try{this.baseUrl=new URL(e)}catch(e){throw new TypeError("ApiClientOption baseUrl is invalid.")}else{if(!(e instanceof URL))throw new TypeError("ApiClientOptions baseurl should be a string or URL");this.baseUrl=e}return this}setResourceName(e){if(!e)throw new TypeError("ApiClientOptions.setResourceName resourceName is required.");if("string"!=typeof e)throw new TypeError("ApiClientOptions.setResourceName resourceName should be a valid string.");return this.resourceName=e,this}getBaseUrl(){return this.baseUrl}getResourceName(){return this.resourceName}async getHeaders(){const e=await this.getCsrfToken();if(e)return{"X-CSRF-Token":e}}async getCsrfToken(){if("undefined"==typeof browser||void 0===browser.cookies){const e=document?.cookie?.split("; ")?.find((e=>e.startsWith("csrfToken")))?.split("=");return e&&2===e.length?e[1]:null}const e=this.baseUrl.toString(),t="/"===e.slice(-1)?e:`${e}/`,r=await browser.cookies.get({name:"csrfToken",url:t});return r?.value||null}}var h=r(5556),d=r.n(h);class p extends Error{constructor(e,t){super(e),this.name="PassboltApiFetchError",this.data=t||{}}}const u=p;class m extends Error{constructor(){super("An internal error occurred. The server response could not be parsed. Please contact your administrator."),this.name="PassboltBadResponseError"}}const g=m;class f extends Error{constructor(e){super(e=e||"The service is unavailable"),this.name="PassboltServiceUnavailableError"}}const E=f,y=["GET","POST","PUT","DELETE"];class v{constructor(e){if(this.options=e,!this.options.getBaseUrl())throw new TypeError("ApiClient constructor error: baseUrl is required.");if(!this.options.getResourceName())throw new TypeError("ApiClient constructor error: resourceName is required.");try{let e=this.options.getBaseUrl().toString();e.endsWith("/")&&(e=e.slice(0,-1));let t=this.options.getResourceName();t.startsWith("/")&&(t=t.slice(1)),t.endsWith("/")&&(t=t.slice(0,-1)),this.baseUrl=`${e}/${t}`,this.baseUrl=new URL(this.baseUrl)}catch(e){throw new TypeError("ApiClient constructor error: b.")}this.apiVersion="api-version=v2"}getDefaultHeaders(){return{Accept:"application/json","content-type":"application/json"}}async buildFetchOptions(){const e=await this.options.getHeaders();return{credentials:"include",headers:{...this.getDefaultHeaders(),...e}}}async get(e,t){this.assertValidId(e);const r=this.buildUrl(`${this.baseUrl}/${e}`,t||{});return this.fetchAndHandleResponse("GET",r)}async delete(e,t,r,s){let n;this.assertValidId(e),void 0===s&&(s=!1),n=s?this.buildUrl(`${this.baseUrl}/${e}/dry-run`,r||{}):this.buildUrl(`${this.baseUrl}/${e}`,r||{});let i=null;return t&&(i=this.buildBody(t)),this.fetchAndHandleResponse("DELETE",n,i)}async findAll(e){const t=this.buildUrl(this.baseUrl.toString(),e||{});return this.fetchAndHandleResponse("GET",t)}async create(e,t){const r=this.buildUrl(this.baseUrl.toString(),t||{}),s=this.buildBody(e);return this.fetchAndHandleResponse("POST",r,s)}async update(e,t,r,s){let n;this.assertValidId(e),void 0===s&&(s=!1),n=s?this.buildUrl(`${this.baseUrl}/${e}/dry-run`,r||{}):this.buildUrl(`${this.baseUrl}/${e}`,r||{});let i=null;return t&&(i=this.buildBody(t)),this.fetchAndHandleResponse("PUT",n,i)}async updateAll(e,t={}){const r=this.buildUrl(this.baseUrl.toString(),t),s=e?this.buildBody(e):null;return this.fetchAndHandleResponse("PUT",r,s)}assertValidId(e){if(!e)throw new TypeError("ApiClient.assertValidId error: id cannot be empty");if("string"!=typeof e)throw new TypeError("ApiClient.assertValidId error: id should be a string")}assertMethod(e){if("string"!=typeof e)throw new TypeError("ApiClient.assertValidMethod method should be a string.");if(y.indexOf(e.toUpperCase())<0)throw new TypeError(`ApiClient.assertValidMethod error: method ${e} is not supported.`)}assertUrl(e){if(!e)throw new TypeError("ApliClient.assertUrl error: url is required.");if(!(e instanceof URL))throw new TypeError("ApliClient.assertUrl error: url should be a valid URL object.");if("https:"!==e.protocol&&"http:"!==e.protocol)throw new TypeError("ApliClient.assertUrl error: url protocol should only be https or http.")}assertBody(e){if(!(e instanceof FormData)&&"string"!=typeof e)throw new TypeError("ApiClient.assertBody error: body should be a string or a FormData.")}buildBody(e){return JSON.stringify(e)}buildUrl(e,t){if("string"!=typeof e)throw new TypeError("ApiClient.buildUrl error: url should be a string.");const r=new URL(`${e}.json?${this.apiVersion}`);t=t||{};for(const[e,s]of Object.entries(t)){if("string"!=typeof e)throw new TypeError("ApiClient.buildUrl error: urlOptions key should be a string.");if("string"==typeof s)r.searchParams.append(e,s);else{if(!Array.isArray(s))throw new TypeError("ApiClient.buildUrl error: urlOptions value should be a string or array.");s.forEach((t=>{r.searchParams.append(e,t)}))}}return r}async sendRequest(e,t,r,s){this.assertUrl(t),this.assertMethod(e),r&&this.assertBody(r);const n="undefined"!=typeof customApiClientFetch?customApiClientFetch:fetch,i={...await this.buildFetchOptions(),...s};i.method=e,r&&(i.body=r);try{return await n(t.toString(),i)}catch(e){throw console.error(e),navigator.onLine?new E("Unable to reach the server, an unexpected error occurred"):new E("Unable to reach the server, you are not connected to the network")}}async fetchAndHandleResponse(e,t,r,s){const n=await this.sendRequest(e,t,r,s);return this.parseResponseJson(n)}async parseResponseJson(e){let t;try{t=await e.json()}catch(t){throw console.debug(e.url.toString(),t),new g(t,e)}if(!e.ok){const r=t.header.message;throw new u(r,{code:e.status,body:t.body})}return t}}const b=class{constructor(e){this.apiClientOptions=e}async find(){this.initClient();const e=await this.apiClient.findAll(),t=e?.body;return t}async save(e){this.initClient(),await this.apiClient.create(e)}async delete(e){this.initClient(),await this.apiClient.delete(e)}async checkDomainAllowed(e){this.initClient("dry-run"),await this.apiClient.create(e)}initClient(e="settings"){this.apiClientOptions.setResourceName(`self-registration/${e}`),this.apiClient=new v(this.apiClientOptions)}},w=[{id:"azure",name:"Microsoft",icon:s.createElement("svg",{width:"65",height:"64",viewBox:"0 0 65 64",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M31.3512 3.04762H3.92261V30.4762H31.3512V3.04762Z",fill:"#F25022"}),s.createElement("path",{d:"M31.3512 33.5238H3.92261V60.9524H31.3512V33.5238Z",fill:"#00A4EF"}),s.createElement("path",{d:"M61.8274 3.04762H34.3988V30.4762H61.8274V3.04762Z",fill:"#7FBA00"}),s.createElement("path",{d:"M61.8274 33.5238H34.3988V60.9524H61.8274V33.5238Z",fill:"#FFB900"})),defaultConfig:{url:"https://login.microsoftonline.com",client_id:"",client_secret:"",tenant_id:"",client_secret_expiry:"",prompt:"login",email_claim:"email"}},{id:"google",name:"Google",icon:s.createElement("svg",{width:"65",height:"64",viewBox:"0 0 65 64",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M63.9451 32.72C63.9451 30.6133 63.7584 28.6133 63.4384 26.6667H33.3051V38.6933H50.5584C49.7851 42.64 47.5184 45.9733 44.1584 48.24V56.24H54.4517C60.4784 50.6667 63.9451 42.4533 63.9451 32.72Z",fill:"#4285F4"}),s.createElement("path",{d:"M33.305 64C41.945 64 49.1717 61.12 54.4517 56.24L44.1583 48.24C41.2783 50.16 37.625 51.3333 33.305 51.3333C24.9583 51.3333 17.8917 45.7067 15.3583 38.1067H4.745V46.3467C9.99833 56.8 20.7983 64 33.305 64Z",fill:"#34A853"}),s.createElement("path",{d:"M15.3584 38.1067C14.6917 36.1867 14.3451 34.1333 14.3451 32C14.3451 29.8667 14.7184 27.8133 15.3584 25.8933V17.6533H4.74505C2.55838 21.9733 1.30505 26.8267 1.30505 32C1.30505 37.1733 2.55838 42.0267 4.74505 46.3467L15.3584 38.1067Z",fill:"#FBBC05"}),s.createElement("path",{d:"M33.305 12.6667C38.025 12.6667 42.2383 14.2933 45.5717 17.4667L54.6917 8.34667C49.1717 3.17334 41.945 0 33.305 0C20.7983 0 9.99833 7.20001 4.745 17.6533L15.3583 25.8933C17.8917 18.2933 24.9583 12.6667 33.305 12.6667Z",fill:"#EA4335"})),defaultConfig:{client_id:"",client_secret:""}},{id:"oauth2",name:"OpenID",hiddenIfDisabled:!0,disabledForRecover:!0,icon:s.createElement("svg",{width:"65",height:"60",viewBox:"0 0 65 60",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M64.2468 34.9929L62.9089 21.0968L57.9256 23.9083C53.2914 21.0968 47.3581 19.1061 40.7332 18.3046V24.4577C44.5336 25.117 47.9462 26.3321 50.7513 27.9544L45.5031 30.9146L64.2533 34.9929H64.2468Z",fill:"#B3B3B3"}),s.createElement("path",{d:"M9.94184 38.8774C9.94184 32.0069 17.4264 26.2222 27.632 24.4577V18.2981C12.023 20.1854 0.246826 28.6783 0.246826 38.8774C0.246826 49.0766 12.8891 58.1769 29.3319 59.6312V53.5557C18.2666 52.166 9.94184 46.1228 9.94184 38.8774Z",fill:"#B3B3B3"}),s.createElement("path",{d:"M29.332 5.09999V59.6377L39.027 55.0746V0.362366L29.332 5.09999Z",fill:"#F8931E"})),defaultConfig:{url:"",openid_configuration_path:"",scope:"openid email profile",client_id:"",client_secret:""}},{id:"adfs",name:"AD FS",hiddenIfDisabled:!0,disabledForRecover:!0,icon:s.createElement("svg",{width:"65",height:"64",viewBox:"0 0 65 64",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M64.5443 48.7454V62.166C64.5443 63.7378 64.0607 64.0602 62.5695 63.8184C52.5746 62.3272 42.4587 60.957 32.3831 59.5464C30.5695 59.3046 29.9247 58.6597 29.9247 56.6849C30.0859 49.5514 30.0053 42.3776 29.9247 35.1635C29.9247 33.5917 30.4083 33.1081 31.9801 33.1081C42.2975 33.1887 52.4536 33.1887 62.5695 33.1887C64.2219 33.1887 64.6249 33.8335 64.6249 35.3247C64.4637 39.8386 64.5443 44.2718 64.5443 48.7454Z",fill:"#00AAF2"}),s.createElement("path",{d:"M47.416 30.6093C42.3379 30.6093 37.2598 30.5287 32.1817 30.6093C30.6099 30.6093 29.9651 30.2869 29.9651 28.4733C30.0457 21.1786 30.0457 14.0048 29.9651 6.79069C29.9651 5.38011 30.4487 4.89648 31.7787 4.65467C42.1767 3.16349 52.5747 1.7126 62.9726 0.140816C64.7862 -0.100997 64.4638 1.10807 64.4638 2.11563C64.4638 8.56399 64.5444 15.1333 64.4638 21.5816C64.4638 23.9595 64.3832 26.3373 64.4638 28.7151C64.5444 30.2063 63.9802 30.6093 62.5696 30.6093C57.5721 30.5287 52.4941 30.6093 47.416 30.6093Z",fill:"#00AAF2"}),s.createElement("path",{d:"M13.8038 33.3096H25.1691C26.3782 33.3096 26.9021 33.7126 26.9021 34.962V57.37C26.9021 58.6597 26.3378 58.7806 25.1691 58.6597C17.6326 57.5312 10.096 56.4431 2.59981 55.3952C1.10863 55.1534 0.625 54.6698 0.625 53.098C0.705605 47.1332 0.705605 41.1685 0.625 35.0829C0.625 33.5917 1.02802 33.1887 2.51921 33.1887C6.34792 33.3096 10.0154 33.3096 13.8038 33.3096Z",fill:"#00AAF2"}),s.createElement("path",{d:"M13.8038 30.6093H2.59977C1.18919 30.6093 0.705566 30.1257 0.705566 28.6345C0.786171 22.7504 0.786171 16.8663 0.705566 10.9418C0.705566 9.53126 1.10859 9.04763 2.59977 8.80582C10.1363 7.83856 17.6728 6.7504 25.169 5.54133C26.902 5.29952 27.0633 5.86375 27.0633 7.27433V28.7151C27.0633 30.2869 26.4184 30.5287 25.0078 30.5287C21.2597 30.5287 17.4713 30.6093 13.8038 30.6093Z",fill:"#00AAF2"})),defaultConfig:{url:"",openid_configuration_path:"",scope:"openid email profile",client_id:"",client_secret:""}}];function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},S.apply(null,arguments)}const C=s.createContext({unexpectedError:null,state:null,isSsoRecoverEnabled:!1,getSsoProviderId:()=>{},onInitializeTriageRequested:()=>{},onTriageRequested:()=>{},onRegistrationRequested:()=>{},handleSwitchToSsoSignInState:()=>{},handleSwitchToUsernameState:()=>{},handleSwitchToEnterNameState:()=>{}});class T extends s.Component{constructor(e){super(e),this.state=Object.assign(this.defaultState,e.value)}get defaultState(){return this.findSsoProviderId=this.findSsoProviderId.bind(this),{unexpectedError:null,state:R.INITIAL_STATE,isSsoRecoverEnabled:!1,ssoProviderId:null,getSsoProviderId:this.getSsoProviderId.bind(this),onInitializeTriageRequested:this.onInitializeTriageRequested.bind(this),onTriageRequested:this.onTriageRequested.bind(this),onRegistrationRequested:this.onRegistrationRequested.bind(this),handleSwitchToSsoSignInState:this.handleSwitchToSsoSignInState.bind(this),handleSwitchToUsernameState:this.handleSwitchToUsernameState.bind(this),handleSwitchToEnterNameState:this.handleSwitchToEnterNameState.bind(this)}}async onInitializeTriageRequested(){const e=this.isSsoAvailable(),t=e?await this.findSsoProviderId():null,r=e&&Boolean(t);this.setState({ssoProviderId:t,isSsoRecoverEnabled:r,state:r?R.SSO_SIGN_IN_STATE:R.USERNAME_STATE})}isSsoAvailable(){return this.props.context.siteSettings.canIUse("ssoRecover")&&this.props.context.siteSettings.canIUse("sso")}getSsoProviderId(){return this.state.ssoProviderId}async findSsoProviderId(){const e=this.props.context.getApiClientOptions();e.setResourceName("sso/settings/current");const t=new v(e);let r=null;try{r=await t.findAll()}catch(e){return console.error(e),null}const s=r.body.provider;if(!s)return null;const n=w.find((e=>e.id===s));if(!n){const e=new Error("The given SSO provider id is not valid");return console.error(e),null}return n.disabledForRecover?(console.log("Recover processes with this SSO provider is not supported"),null):s}async onTriageRequested(e){const t={username:e},r=this.props.context.getApiClientOptions();r.setResourceName("users/recover");const s=new v(r);await s.create(t).then(this.handleTriageSuccess.bind(this)).catch((t=>this.handleTriageError(t,e)))}async handleTriageSuccess(){return this.setState({state:R.CHECK_MAILBOX_STATE})}async handleTriageError(e,t){const r=e.data&&404===e.data.code;let s=R.USERNAME_NOT_FOUND_ERROR;if(r&&this.canIUseSelfRegistrationSettings)try{await this.isDomainAllowedToSelfRegister(t),s=R.NAME_STATE}catch(e){e.data&&(400===e.data.code||403===e.data.code)||(this.setState({unexpectedError:new E(e.message)}),s=R.UNEXPECTED_ERROR_STATE)}this.setState({username:t,state:s})}async onRegistrationRequested(e,t){const r={username:this.state.username,profile:{first_name:e,last_name:t}};this.register(r)}async handleRegistrationSuccess(){return this.setState({state:R.CHECK_MAILBOX_STATE})}async handleRegistrationError(){this.setState({state:R.UNEXPECTED_ERROR_STATE})}handleSwitchToSsoSignInState(){this.setState({state:R.SSO_SIGN_IN_STATE})}handleSwitchToUsernameState(){this.setState({state:R.USERNAME_STATE})}handleSwitchToEnterNameState(e){this.setState({username:e,state:R.NAME_STATE})}get canIUseSelfRegistrationSettings(){return this.props.context.siteSettings.canIUse("selfRegistration")}async isDomainAllowedToSelfRegister(e){const t=this.props.context.getApiClientOptions(),r=new b(t),s={email:e,provider:"email_domains"};await r.checkDomainAllowed(s)}async register(e){const t=this.props.context.getApiClientOptions().setResourceName("users/register"),r=new v(t);await r.create(e).then(this.handleRegistrationSuccess.bind(this)).catch(this.handleRegistrationError.bind(this))}render(){return s.createElement(C.Provider,{value:this.state},this.props.children)}}T.propTypes={context:d().any,value:d().any,children:d().any};const x=o(T);function P(e){return class extends s.Component{render(){return s.createElement(C.Consumer,null,(t=>s.createElement(e,S({apiTriageContext:t},this.props))))}}}const R={INITIAL_STATE:"Initial State",USERNAME_STATE:"Enter username state",SSO_SIGN_IN_STATE:"SSO Sign in state",CHECK_MAILBOX_STATE:"Check mailbox state",NAME_STATE:"Enter name state",USERNAME_NOT_FOUND_ERROR:"Username not found error state",UNEXPECTED_ERROR_STATE:"Unexpected error state"};var I,O,A=r(2389);function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},U.apply(null,arguments)}const L=function(e){return s.createElement("svg",U({width:18,height:18,fill:"none",className:"svg-icon spinner",viewBox:"0 0 18 18"},e),I||(I=s.createElement("circle",{id:"background",cx:8,cy:8,r:8,fill:"none",stroke:"var(--spinner-background)",strokeWidth:"var(--spinner-stroke-width)",transform:"translate(1 1)"})),O||(O=s.createElement("circle",{id:"loading",r:8,fill:"none",stroke:"var(--spinner-color)",strokeLinecap:"round",strokeWidth:"var(--spinner-stroke-width)",transform:"translate(9 9)"})))};class k extends s.Component{render(){return s.createElement("div",{className:"login-processing"},s.createElement("h1",null,this.props.title),s.createElement("div",{className:"processing-wrapper"},s.createElement(L,null)))}}k.propTypes={title:d().oneOfType([d().arrayOf(d().node),d().node,d().string])},k.defaultProps={title:s.createElement(A.x6,null,"Please wait...")};const N=(0,A.CI)("common")(k);class _ extends s.Component{constructor(e){super(e),this.bindCallbacks()}bindCallbacks(){this.getClassName=this.getClassName.bind(this)}getClassName(){let e="button primary form";return this.props.warning?e+=" warning":this.props.attention&&(e+=" attention"),this.props.disabled&&(e+=" disabled"),this.props.processing&&(e+=" processing"),this.props.big&&(e+=" big"),this.props.medium&&(e+=" medium"),this.props.fullWidth&&(e+=" full-width"),e}render(){return s.createElement("button",{type:"submit",className:this.getClassName(),disabled:this.props.disabled},this.props.value||s.createElement(A.x6,null,"Save"),this.props.processing&&s.createElement(L,null))}}_.defaultProps={warning:!1,attention:!1},_.propTypes={processing:d().bool,disabled:d().bool,value:d().oneOfType([d().arrayOf(d().node),d().node,d().string]),warning:d().bool,attention:d().bool,big:d().bool,medium:d().bool,fullWidth:d().bool};const D=(0,A.CI)("common")(_),V=(e,t)=>t.split(".").reduce(((e,t)=>e?.[t]),e),$=(e,t)=>{if(void 0===e||"string"!=typeof e||!e.length)return!1;if((t=t||{}).whitelistedProtocols&&!Array.isArray(t.whitelistedProtocols))throw new TypeError("The whitelistedProtocols should be an array of string.");if(t.defaultProtocol&&"string"!=typeof t.defaultProtocol)throw new TypeError("The defaultProtocol should be a string.");const r=t.whitelistedProtocols||[F.HTTP,F.HTTPS],s=[F.JAVASCRIPT],n=t.defaultProtocol||"";!/^((?!:\/\/).)*:\/\//.test(e)&&n&&(e=`${n}//${e}`);try{const t=new URL(e);return!s.includes(t.protocol)&&!!r.includes(t.protocol)&&t.href}catch(e){return!1}},F={FTP:"http:",FTPS:"https:",HTTP:"http:",HTTPS:"https:",JAVASCRIPT:"javascript:",SSH:"ssh:"};class j{constructor(e){this.settings=this.sanitizeDto(e)}sanitizeDto(e){const t=JSON.parse(JSON.stringify(e));return this.sanitizeEmailValidateRegex(t),t}sanitizeEmailValidateRegex(e){const t=e?.passbolt?.email?.validate?.regex;t&&"string"==typeof t&&t.trim().length&&(e.passbolt.email.validate.regex=t.trim().replace(/^\/+/,"").replace(/\/+$/,""))}canIUse(e){let t=!1;const r=`passbolt.plugins.${e}`,s=V(this.settings,r)||null;if(s&&"object"==typeof s){const e=V(s,"enabled");void 0!==e&&!0!==e||(t=!0)}return t}getPluginSettings(e){const t=`passbolt.plugins.${e}`;return V(this.settings,t)}getRememberMeOptions(){return(this.getPluginSettings("rememberMe")||{}).options||{}}get hasRememberMeUntilILogoutOption(){return void 0!==(this.getRememberMeOptions()||{})[-1]}getServerTimezone(){return V(this.settings,"passbolt.app.server_timezone")}get termsLink(){const e=V(this.settings,"passbolt.legal.terms.url");return!!e&&$(e)}get privacyLink(){const e=V(this.settings,"passbolt.legal.privacy_policy.url");return!!e&&$(e)}get registrationPublic(){return!0===V(this.settings,"passbolt.registration.public")}get debug(){return!0===V(this.settings,"app.debug")}get url(){return V(this.settings,"app.url")||""}get version(){return V(this.settings,"app.version.number")}get locale(){return V(this.settings,"app.locale")||j.DEFAULT_LOCALE.locale}async setLocale(e){this.settings.app.locale=e}get supportedLocales(){return V(this.settings,"passbolt.plugins.locale.options")||j.DEFAULT_SUPPORTED_LOCALES}get generatorConfiguration(){return V(this.settings,"passbolt.plugins.generator.configuration")}get emailValidateRegex(){return this.settings?.passbolt?.email?.validate?.regex||null}static get DEFAULT_SUPPORTED_LOCALES(){return[j.DEFAULT_LOCALE]}static get DEFAULT_LOCALE(){return{locale:"en-UK",label:"English"}}}var M=r(3050),B=r.n(M);class q{static validate(e){return"string"==typeof e&&B()("^[\\p{L}0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\\p{L}0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[_\\p{L}0-9][-_\\p{L}0-9]*\\.)*(?:[\\p{L}0-9][-\\p{L}0-9]{0,62})\\.(?:(?:[a-z]{2}\\.)?[a-z]{2,})$","i").test(e)}}class H{constructor(e){if("string"!=typeof e)throw Error("The regex should be a string.");this.regex=new(B())(e)}validate(e){return"string"==typeof e&&this.regex.test(e)}}class z{static validate(e,t){return z.getValidator(t).validate(e)}static getValidator(e){return e&&e instanceof j&&e.emailValidateRegex?new H(e.emailValidateRegex):q}}class K extends s.Component{constructor(e){super(e),this.state=this.defaultState,this.createInputRefs(),this.bindEventHandlers()}get defaultState(){return{loading:!0,processing:!1,username:"",usernameError:null,agreedTerms:!1,agreedTermsError:null,hasAlreadyBeenValidated:!1}}componentDidMount(){null!==this.props.context.siteSettings&&this.setState({loading:!1},(()=>{this.focusUsernameElement()}))}async componentDidUpdate(){this.state.loading&&null!==this.props.context.siteSettings&&this.setState({loading:!1},(()=>{this.focusUsernameElement()}))}focusUsernameElement(){this.isFocusOnBrowserExtension()||this.usernameRef.current.focus()}isFocusOnBrowserExtension(){const e=document.activeElement;return!!e&&"iframe"===e.tagName.toLowerCase()}bindEventHandlers(){this.handleInputChange=this.handleInputChange.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleUsernameInputOnKeyUp=this.handleUsernameInputOnKeyUp.bind(this)}createInputRefs(){this.usernameRef=s.createRef()}async handleInputChange(e){const t=e.target,r="checkbox"===t.type?t.checked:t.value,s=t.name;await this.setState({[s]:r}),this.state.hasAlreadyBeenValidated&&await this.validate()}handleUsernameInputOnKeyUp(){if(this.state.hasAlreadyBeenValidated){const e=this.validateUsernameInput();this.setState(e)}}async handleFormSubmit(e){if(e.preventDefault(),await this.setState({hasAlreadyBeenValidated:!0}),!this.state.processing){if(await this.toggleProcessing(),await this.validate(),this.hasValidationError())return void await this.toggleProcessing();this.props.apiTriageContext.onTriageRequested(this.state.username.trim())}}async toggleProcessing(){const e=this.state.processing;return this.setState({processing:!e})}async validate(){return await Promise.all([this.validateUsernameInput(),this.validateAgreedTerms()]),this.hasValidationError()}async validateUsernameInput(){let e=null;const t=this.state.username.trim();return t.length?z.validate(t,this.props.context.siteSettings)||(e=this.translate("Please enter a valid email address.")):e=this.translate("A username is required."),this.setState({username:t,usernameError:e})}async validateAgreedTerms(){let e=!1;const t=this.privacyLink||this.termsLink,r=this.state.agreedTerms;return t&&!r&&(e=!0),this.setState({agreedTermsError:e})}hasValidationError(){return null!==this.state.usernameError||this.state.agreedTermsError}hasAllInputDisabled(){return this.state.processing||this.state.loading}get privacyLink(){return!!this.props.context.siteSettings&&this.props.context.siteSettings.privacyLink}get termsLink(){return!!this.props.context.siteSettings&&this.props.context.siteSettings.termsLink}get translate(){return this.props.t}render(){return s.createElement("div",{className:"enter-username"},s.createElement("h1",null,s.createElement(A.x6,null,"Please enter your email to continue.")),s.createElement("form",{acceptCharset:"utf-8",onSubmit:this.handleFormSubmit,noValidate:!0},s.createElement("div",{className:`input text required ${this.state.usernameError?"error":""} ${this.hasAllInputDisabled()?"disabled":""}`},s.createElement("label",{htmlFor:"username"},s.createElement(A.x6,null,"Email")),s.createElement("input",{id:"username-input",type:"text",ref:this.usernameRef,name:"username",value:this.state.username,onKeyUp:this.handleUsernameInputOnKeyUp,onChange:this.handleInputChange,placeholder:this.translate("you@organization.com"),required:"required",disabled:this.hasAllInputDisabled()}),this.state.usernameError&&s.createElement("div",{className:"error-message"},this.state.usernameError)),(this.privacyLink||this.termsLink)&&s.createElement("div",{className:"input checkbox "+(this.state.agreedTermsError?"error":"")},s.createElement("input",{type:"checkbox",name:"agreedTerms",value:this.state.agreedTerms,onChange:this.handleInputChange,id:"checkbox-terms",disabled:this.hasAllInputDisabled()}),s.createElement("label",{htmlFor:"checkbox-terms"},(this.privacyLink||this.termsLink)&&s.createElement("span",null,this.termsLink&&!this.privacyLink&&s.createElement(A.x6,null,"I accept the ",s.createElement("a",{href:this.termsLink,target:"_blank",rel:"noopener noreferrer"},"terms")),!this.termsLink&&this.privacyLink&&s.createElement(A.x6,null,"I accept the ",s.createElement("a",{href:this.privacyLink,target:"_blank",rel:"noopener noreferrer"},"privacy policy")),this.termsLink&&this.privacyLink&&s.createElement(A.x6,null,"I accept the ",s.createElement("a",{href:this.termsLink,target:"_blank",rel:"noopener noreferrer"},"terms")," and the ",s.createElement("a",{href:this.privacyLink,target:"_blank",rel:"noopener noreferrer"},"privacy policy"))))),s.createElement("div",{className:"form-actions"},s.createElement(D,{disabled:this.hasAllInputDisabled(),big:!0,processing:this.state.processing,fullWidth:!0,value:this.translate("Next")}),this.props.isSsoRecoverEnabled&&s.createElement("button",{className:"link",type:"button",onClick:this.props.onSecondaryActionClick},s.createElement(A.x6,null,"Continue with SSO.")))))}}K.defaultProps={isSsoRecoverEnabled:!1},K.propTypes={apiTriageContext:d().object,context:d().any,isSsoRecoverEnabled:d().bool.isRequired,onSecondaryActionClick:d().func,t:d().func};const W=o(P((0,A.CI)("common")(K)));class G extends s.Component{constructor(e){super(e),this.state=this.defaultState,this.createInputRefs(),this.bindEventHandlers()}componentDidMount(){this.setState({loading:!1},(()=>{this.firstnameRef.current.focus()}))}get defaultState(){return{loading:!0,processing:!1,firstname:"",firstnameError:null,lastname:"",lastnameError:null,hasAlreadyBeenValidated:!1}}bindEventHandlers(){this.handleInputChange=this.handleInputChange.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleFirstnameInputOnKeyUp=this.handleFirstnameInputOnKeyUp.bind(this),this.handleLastnameInputOnKeyUp=this.handleLastnameInputOnKeyUp.bind(this)}createInputRefs(){this.firstnameRef=s.createRef(),this.lastnameRef=s.createRef()}handleInputChange(e){const t=e.target,r=t.value,s=t.name;this.setState({[s]:r})}handleFirstnameInputOnKeyUp(){if(this.state.hasAlreadyBeenValidated){const e=this.validateFirstnameInput();this.setState(e)}}handleLastnameInputOnKeyUp(){if(this.state.hasAlreadyBeenValidated){const e=this.validateLastnameInput();this.setState(e)}}async handleFormSubmit(e){if(e.preventDefault(),await this.setState({hasAlreadyBeenValidated:!0}),!this.state.processing){if(await this.toggleProcessing(),await this.validate(),this.hasValidationError())return await this.toggleProcessing(),void this.focusFirstFieldError();await this.props.apiTriageContext.onRegistrationRequested(this.state.firstname,this.state.lastname)}}async toggleProcessing(){const e=this.state.processing;return this.setState({processing:!e})}async validate(){return await Promise.all([this.validateFirstnameInput(),this.validateLastnameInput()]),this.hasValidationError()}async validateFirstnameInput(){let e=null;return this.state.firstname.trim().length||(e=this.translate("A first name is required.")),this.setState({firstnameError:e})}async validateLastnameInput(){let e=null;return this.state.lastname.trim().length||(e=this.translate("A last name is required.")),this.setState({lastnameError:e})}focusFirstFieldError(){this.state.firstnameError?this.firstnameRef.current.focus():this.state.lastnameError&&this.lastnameRef.current.focus()}hasValidationError(){return null!==this.state.firstnameError||null!==this.state.lastnameError}hasAllInputDisabled(){return this.state.processing||this.state.loading}get translate(){return this.props.t}render(){return s.createElement("div",{className:"enter-name"},s.createElement("h1",null,s.createElement(A.x6,null,"New here? Enter your name to get started.")),s.createElement("form",{acceptCharset:"utf-8",onSubmit:this.handleFormSubmit,noValidate:!0},s.createElement("div",{className:`input text required ${this.state.firstnameError?"error":""} ${this.hasAllInputDisabled()?"disabled":""}`},s.createElement("label",{htmlFor:"firstname"},s.createElement(A.x6,null,"First name")),s.createElement("input",{id:"firstname-input",type:"text",name:"firstname",ref:this.firstnameRef,value:this.state.firstname,onKeyUp:this.handleFirstnameInputOnKeyUp,onChange:this.handleInputChange,disabled:this.hasAllInputDisabled(),placeholder:this.translate("First name"),required:"required"}),this.state.firstnameError&&s.createElement("div",{className:"error-message"},this.state.firstnameError)),s.createElement("div",{className:`input text required ${this.state.lastnameError?"error":""} ${this.hasAllInputDisabled()?"disabled":""}`},s.createElement("label",{htmlFor:"lastname"},s.createElement(A.x6,null,"Last name")),s.createElement("input",{id:"lastname-input",type:"text",name:"lastname",ref:this.lastnameRef,value:this.state.lastname,onKeyUp:this.handleLastnameInputOnKeyUp,onChange:this.handleInputChange,disabled:this.hasAllInputDisabled(),placeholder:this.translate("Last name"),required:"required"}),this.state.lastnameError&&s.createElement("div",{className:"error-message"},this.state.lastnameError)),s.createElement("div",{className:"form-actions"},s.createElement(D,{disabled:this.hasAllInputDisabled(),big:!0,fullWidth:!0,processing:this.state.processing,value:this.translate("Sign up")}),s.createElement("a",{href:`${this.props.context.trustedDomain}/auth/login?locale=${this.props.context.locale}`,rel:"noopener noreferrer"},s.createElement(A.x6,null,"I already have an account")))))}}G.propTypes={apiTriageContext:d().object,context:d().any,t:d().func};const Z=o(P((0,A.CI)("common")(G)));class J extends s.Component{render(){return s.createElement("div",{className:"email-sent-instructions"},s.createElement("div",{className:"email-sent-bg"}),s.createElement("h1",null,s.createElement(A.x6,null,"Check your mailbox!")),s.createElement("p",null,s.createElement(A.x6,null,"We sent you a link to verify your email."),s.createElement("br",null),s.createElement(A.x6,null,"Check your spam folder if you do not hear from us after a while.")))}}J.propTypes={};const X=(0,A.CI)("common")(J);class Y extends s.Component{render(){return s.createElement("div",{className:"setup-error"},s.createElement("h1",null,s.createElement(A.x6,null,"Access to this service requires an invitation.")),s.createElement("p",null,s.createElement(A.x6,null,"This email is not associated with any approved users on this domain.")," ",s.createElement(A.x6,null,"Please contact your administrator to request an invitation link.")),s.createElement("div",{className:"form-actions"},s.createElement("a",{href:`${this.props.context.trustedDomain}/users/recover`,className:"button primary big full-width",role:"button",rel:"noopener noreferrer"},s.createElement(A.x6,null,"Try with another email"))))}}Y.propTypes={context:d().any};const Q=o((0,A.CI)("common")(Y));var ee;function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},te.apply(null,arguments)}const re=function(e){return s.createElement("svg",te({xmlns:"http://www.w3.org/2000/svg",width:10,height:8,fill:"none",viewBox:"0 0 10 8"},e),ee||(ee=s.createElement("path",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m1 2 4 4 4-4"})))};var se;function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ne.apply(null,arguments)}const ie=function(e){return s.createElement("svg",ne({xmlns:"http://www.w3.org/2000/svg",width:8,height:10,fill:"none",viewBox:"0 0 8 10"},e),se||(se=s.createElement("path",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2 9 4-4-4-4"})))};class ae extends s.Component{constructor(e){super(e),this.state=this.defaultState,this.bindCallbacks()}get defaultState(){return{showErrorDetails:!1}}bindCallbacks(){this.handleErrorDetailsToggle=this.handleErrorDetailsToggle.bind(this)}onClick(){this.props.context.port?this.props.context.port.request("passbolt.tab.reload"):window.location.reload()}handleErrorDetailsToggle(){this.setState({showErrorDetails:!this.state.showErrorDetails})}get hasErrorDetails(){const e=this.props?.error;return Boolean(e?.details)||Boolean(e?.data?.body)}formatErrors(){const e=this.props.error?.details||this.props.error?.data;return JSON.stringify(e,null,4)}render(){return s.createElement("div",{className:"setup-error"},s.createElement("h1",null,this.props.title),s.createElement("p",null,this.props.message),s.createElement("p",null,this.props.error&&this.props.error.message),this.hasErrorDetails&&s.createElement("div",{className:"accordion error-details"},s.createElement("div",{className:"accordion-header"},s.createElement("button",{className:"no-border",type:"button",onClick:this.handleErrorDetailsToggle},this.state.showErrorDetails?s.createElement(re,{className:"caret-down"}):s.createElement(ie,{className:"caret-right"}),s.createElement("span",null,s.createElement(A.x6,null,"Error details")))),this.state.showErrorDetails&&s.createElement("div",{className:"accordion-content"},s.createElement("div",{className:"input text"},s.createElement("label",{htmlFor:"js_field_debug",className:"visuallyhidden"},s.createElement(A.x6,null,"Error details")),s.createElement("textarea",{id:"js_field_debug",defaultValue:`${this.formatErrors()}`,readOnly:!0})))),s.createElement("div",{className:"form-actions"},s.createElement("button",{onClick:this.onClick.bind(this),className:"button primary big full-width",role:"button"},s.createElement(A.x6,null,"Try again"))))}}ae.defaultProps={title:s.createElement(A.x6,null,"Something went wrong!"),message:s.createElement(A.x6,null,"The operation failed with the following error:")},ae.propTypes={context:d().any,title:d().oneOfType([d().arrayOf(d().node),d().node,d().string]),message:d().oneOfType([d().arrayOf(d().node),d().node,d().string]),error:d().any};const oe=o((0,A.CI)("common")(ae)),le=class{constructor(e,t){t.setResourceName("/sso/recover/start"),this.apiClient=new v(t),this.expectedUrl=new URL(e)}async getRecoverUrl(e){const t={token:e,case:"default"},r=await this.apiClient.create(t),s=new URL(r.body.url);if(s.origin!==this.expectedUrl.origin)throw new Error("The url should be from the same origin.");return s}};class ce{constructor(e,t={}){(t?.clone??!0)&&(e=JSON.parse(JSON.stringify(e))),this._props=e}toDto(){return JSON.parse(JSON.stringify(this))}toJSON(){return this._props}_hasProp(e){if(!e.includes(".")){const t=ce._normalizePropName(e);return Object.prototype.hasOwnProperty.call(this._props,t)}try{return this._getPropByPath(e),!0}catch(e){return!1}}_getPropByPath(e){return ce._normalizePropName(e).split(".").reduce(((e,t)=>{if(Object.prototype.hasOwnProperty.call(e,t))return e[t];throw new Error}),this._props)}static _normalizePropName(e){return e.replace(/([A-Z])/g,((e,t)=>`_${t.toLowerCase()}`)).replace(/\._/,".").replace(/^_/,"").replace(/^\./,"")}}const he=ce;class de extends Error{constructor(e="Collection validation error."){super(e),this.name="CollectionValidationError",this.errors=[]}addItemValidationError(e,t){if(!Number.isInteger(e))throw new TypeError('CollectionValidationError::addEntityValidationError expects "position" to be an integer.');if(!(t instanceof me||t instanceof de))throw new TypeError('CollectionValidationError::addEntityValidationError expects "entityValidationError" to be an instance of EntityValidationError or CollectionValidationError.');this.errors[e]=t}addCollectionValidationError(e,t){if("string"!=typeof e)throw new TypeError('CollectionValidationError::addCollectionValidationError expects "rule" to be a string.');if("string"!=typeof t)throw new TypeError('CollectionValidationError::addCollectionValidationError expects "error" to be a string.');this.errors[e]=t}hasErrors(){return this.errors.some((e=>Object.keys(e.details).length>0))}get details(){const e={};for(const t in this.errors)this.errors[t]instanceof me||this.errors[t]instanceof de?e[t]=this.errors[t].details:e[t]=this.errors[t];return e}}const pe=de;class ue extends Error{constructor(e="Entity validation error."){super(e),this.name="EntityValidationError",this.details={}}addError(e,t,r){if("string"!=typeof e)throw new TypeError("EntityValidationError addError property should be a string.");if("string"!=typeof t)throw new TypeError("EntityValidationError addError rule should be a string.");if("string"!=typeof r)throw new TypeError("EntityValidationError addError message should be a string.");Object.prototype.hasOwnProperty.call(this.details,e)||(this.details[e]={}),this.details[e][t]=r}addAssociationError(e,t){if("string"!=typeof e)throw new TypeError("EntityValidationError addAssociationError associationName should be a string.");if(!(t instanceof ue||t instanceof pe))throw new TypeError("EntityValidationError addAssociationError errorDetails should be an object.");this.details[e]=t}getError(e,t){if(!this.hasError(e,t))return null;const r=this.details[e];return t?r[t]:r}hasError(e,t){if("string"!=typeof e)throw new TypeError("EntityValidationError hasError property should be a string.");const r=this.details&&Object.prototype.hasOwnProperty.call(this.details,e);if(!r)return!1;if(!t)return r;if("string"!=typeof t)throw new TypeError("EntityValidationError hasError rule should be a string.");return Object.prototype.hasOwnProperty.call(this.details[e],t)}hasErrors(){return Object.keys(this.details).length>0}getFirstRuleErrorByField(e){if(!this.hasError(e))return null;const t=this.details[e];return t[Object.keys(t)[0]]}}const me=ue;var ge=r(7761),fe=r.n(ge);class Ee{static validateSchema(e,t){if(!t)throw new TypeError(`Could not validate entity ${e}. No schema for entity ${e}.`);if(!t.type)throw new TypeError(`Could not validate entity ${e}. Type missing.`);if("array"!==t.type){if("object"===t.type){if(!t.required||!Array.isArray(t.required))throw new TypeError(`Could not validate entity ${e}. Schema error: no required properties.`);if(!t.properties||!Object.keys(t).length)throw new TypeError(`Could not validate entity ${e}. Schema error: no properties.`);const r=t.properties;for(const e in r){if(!Object.prototype.hasOwnProperty.call(r,e)||!r[e].type&&!r[e].anyOf)throw TypeError(`Invalid schema. Type missing for ${e}...`);if(r[e].anyOf&&(!Array.isArray(r[e].anyOf)||!r[e].anyOf.length))throw new TypeError(`Invalid schema, prop ${e} anyOf should be an array`)}}}else if(!t.items)throw new TypeError(`Could not validate entity ${e}. Schema error: missing item definition.`)}static validate(e,t,r){if(!e||!t||!r)throw new TypeError(`Could not validate entity ${e}. No data provided.`);switch(r.type){case"object":return Ee.validateObject(e,t,r);case"array":return Ee.validateArray(e,t,r);default:throw new TypeError(`Could not validate entity ${e}. Unsupported type.`)}}static validateArray(e,t,r){let s;const n=Ee.validateProp("items",t,r);if("number"==typeof r.minItems&&(Ee.isGreaterThanOrEqual(t.length,r.minItems)||(s=Ee.handleCollectionValidationError("minItems",`The items array should contain at least ${r.minItems} item(s).`,s))),"number"==typeof r.maxItems&&(Ee.isLessThanOrEqual(t.length,r.maxItems)||(s=Ee.handleCollectionValidationError("maxItems",`The items array should contain at maximum ${r.maxItems} item(s).`,s))),s)throw s;return n}static validateObject(e,t,r){const s=r.required,n=r.properties,i={};let a;for(const r in n)if(Object.prototype.hasOwnProperty.call(n,r))if(null!==t?.[r]||!0!==n[r]?.nullable){if(s.includes(r)){if(!Object.prototype.hasOwnProperty.call(t,r)){a=Ee.getOrInitEntityValidationError(e,a),a.addError(r,"required",`The ${r} is required.`);continue}}else if(!Object.prototype.hasOwnProperty.call(t,r))continue;try{i[r]=Ee.validateProp(r,t[r],n[r])}catch(t){if(!(t instanceof me))throw t;a=Ee.getOrInitEntityValidationError(e,a),a.details[r]=t.details[r]}}else i[r]=null;if(a)throw a;return i}static getOrInitEntityValidationError(e,t){return t||new me(`Could not validate entity ${e}.`)}static validateProp(e,t,r){if(r.anyOf)return Ee.validateAnyOf(e,t,r.anyOf),t;if(!0===r.nullable&&null===t)return t;if(Ee.validatePropType(e,t,r),r.enum)return Ee.validatePropEnum(e,t,r),t;switch(r.type){case"string":Ee.validatePropTypeString(e,t,r);break;case"integer":case"number":Ee.validatePropTypeNumber(e,t,r);break;case"array":Ee.validatePropTypeArray(e,t,r);break;case"object":case"boolean":case"blob":case"null":break;case"x-custom":Ee.validatePropCustom(e,t,r);break;default:throw new TypeError(`Could not validate property ${e}. Unsupported prop type ${r.type}`)}return t}static validatePropType(e,t,r){if(!Ee.isValidPropType(t,r.type))throw Ee.handlePropertyValidationError(e,"type",`The ${e} is not a valid ${r.type}.`)}static validatePropCustom(e,t,r){try{r.validationCallback(t)}catch(t){throw Ee.handlePropertyValidationError(e,"custom",`The ${e} is not valid: ${t.message}`)}}static validatePropTypeString(e,t,r){let s;if(r.format&&(Ee.isValidStringFormat(t,r.format)||(s=Ee.handlePropertyValidationError(e,"format",`The ${e} is not a valid ${r.format}.`,s))),r.notEmpty&&(Ee.isValidStringNotEmpty(t)||(s=Ee.handlePropertyValidationError(e,"notEmpty",`The ${e} should be not empty`,s))),r.length&&(Ee.isValidStringLength(t,r.length,r.length)||(s=Ee.handlePropertyValidationError(e,"length",`The ${e} should be ${r.length} character in length.`,s))),r.minLength&&(Ee.isValidStringLength(t,r.minLength)||(s=Ee.handlePropertyValidationError(e,"minLength",`The ${e} should be ${r.minLength} character in length minimum.`,s))),r.maxLength&&(Ee.isValidStringLength(t,0,r.maxLength)||(s=Ee.handlePropertyValidationError(e,"maxLength",`The ${e} should be ${r.maxLength} character in length maximum.`,s))),r.pattern&&(fe().matches(t,r.pattern)||(s=Ee.handlePropertyValidationError(e,"pattern",`The ${e} is not valid.`,s))),r.custom&&(r.custom(t)||(s=Ee.handlePropertyValidationError(e,"custom",`The ${e} is not valid.`,s))),s)throw s}static handlePropertyValidationError(e,t,r,s=null){return(s=s||new me(`Could not validate property ${e}.`)).addError(e,t,r),s}static handleCollectionValidationError(e,t,r=null){return(r=r||new pe("Could not validate collection.")).addCollectionValidationError(e,t),r}static validatePropTypeNumber(e,t,r){let s;if("number"==typeof r.minimum&&(Ee.isGreaterThanOrEqual(t,r.minimum)||(s=Ee.handlePropertyValidationError(e,"minimum",`The ${e} should be greater or equal to ${r.minimum}.`,s))),"number"==typeof r.maximum&&(Ee.isLesserThanOrEqual(t,r.maximum)||(s=Ee.handlePropertyValidationError(e,"maximum",`The ${e} should be lesser or equal to ${r.maximum}.`,s))),s)throw s}static validatePropTypeArray(e,t,r){let s;if(r?.items&&"object"==typeof r.items){for(let n=0;n<t.length;n++){const i=`${e}.${n}`;try{this.validateProp(i,t[n],r.items)}catch(t){if(!(t instanceof me))throw t;{s=Ee.getOrInitEntityValidationError(e,s);const r=t.details[i];s.details[e]={...s.details[e],[n]:r}}}}if(s)throw s}}static validatePropEnum(e,t,r){if(!Ee.isPropInEnum(t,r.enum)){const t=new me(`Could not validate property ${e}.`);throw t.addError(e,"enum",`The ${e} value is not included in the supported list.`),t}}static validateAnyOf(e,t,r){for(let s=0;s<r.length;s++)try{return void Ee.validateProp(e,t,r[s])}catch(e){}const s=new me(`Could not validate property ${e}.`);throw s.addError(e,"type",`The ${e} does not match any of the supported types.`),s}static isValidPropType(e,t){if(Array.isArray(t))throw new TypeError("EntitySchema isValidPropType multiple types are not supported.");if("string"!=typeof t)throw new TypeError("EntitySchema isValidPropType type is invalid.");switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"string":return"string"==typeof e;case"integer":return Number.isInteger(e);case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"array":return Array.isArray(e);case"blob":return e instanceof Blob;case"x-custom":return!0;default:throw new TypeError("EntitySchema validation type not supported.")}}static isValidStringFormat(e,t){if("string"!=typeof t)throw new TypeError("EntitySchema validPropFormat format is invalid.");switch(t){case"uuid":return fe().isUUID(e);case"email":case"idn-email":return fe().isEmail(e);case"date-time":return fe().isISO8601(e);case"x-url":return fe().isURL(e,{require_tld:!1});case"x-hex-color":return fe().isHexColor(e);case"x-base64":return fe().isBase64(e);default:throw new TypeError(`EntitySchema string validation format ${t} is not supported.`)}}static isValidStringNotEmpty(e){return!fe().isEmpty(e,{ignore_whitespace:!0})}static isValidStringLength(e,t,r){return t=t||0,fe().isLength(e,t,r)}static isPropInEnum(e,t){if(!t||!Array.isArray(t)||!t.length)throw new TypeError("EntitySchema enum schema cannot be empty.");return t.includes(e)}static isGreaterThanOrEqual(e,t){return e>=t}static isLessThanOrEqual(e,t){return e<=t}static isLesserThanOrEqual(e,t){return e<=t}}const ye=Ee,ve=["https://login.microsoftonline.com","https://login.microsoftonline.us","https://login.partner.microsoftonline.cn"],be=/^https:\/\/login\.(microsoftonline\.(com|us)|partner\.microsoftonline\.cn)$/;class we extends he{constructor(e,t={}){const r=we.sanitizeDto(e);super(ye.validate(we.ENTITY_NAME,r,we.getSchema()),t)}static getSchema(){return{type:"object",required:["url","client_id","tenant_id","client_secret","client_secret_expiry"],properties:{url:{type:"string",pattern:be},client_id:{type:"string",format:"uuid"},tenant_id:{type:"string",format:"uuid"},client_secret:{type:"string",minLength:1},client_secret_expiry:{type:"string",format:"date-time"},email_claim:{type:"string",enum:["email","preferred_username","upn"]},prompt:{type:"string",enum:["login","none"]}}}}static sanitizeDto(e){return e=Object.assign({},e),e?.email_claim||(e.email_claim="email"),e?.prompt||(e.prompt="login"),e}static get ENTITY_NAME(){return"AzureSsoSettings"}static get PROVIDER_ID(){return"azure"}static get SUPPORTED_URLS(){return ve}}const Se=we,Ce=["https://accounts.google.com"];class Te extends he{constructor(e,t={}){super(ye.validate(Te.ENTITY_NAME,e,Te.getSchema()),t)}static getSchema(){return{type:"object",required:["client_id","client_secret"],properties:{client_id:{type:"string",minLength:1},client_secret:{type:"string",minLength:1}}}}static get ENTITY_NAME(){return"GoogleSsoSettings"}static get PROVIDER_ID(){return"google"}static get SUPPORTED_URLS(){return Ce}}const xe=Te,Pe={[Se.PROVIDER_ID]:Se.SUPPORTED_URLS,[xe.PROVIDER_ID]:xe.SUPPORTED_URLS},Re=class{constructor(e){this.apiClientOptions=e}async getUrl(e){this.apiClientOptions.setResourceName(`/sso/recover/${e}`);const t=new v(this.apiClientOptions),r=await t.create(),s=new URL(r.body.url),n=Pe[e];if(!n)throw new Error("The url should be part of the list of supported single sign-on urls.");if(!n.some((e=>e===s.origin)))throw new Error("The url should be part of the list of supported single sign-on urls.");return s}},Ie=/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[0-5][a-fA-F0-9]{3}-[089aAbB][a-fA-F0-9]{3}-[a-fA-F0-9]{12}$/,Oe="default",Ae="registration_required",Ue=class{constructor(e,t){this.popup=null,this.intervalCheck=null,this.expectedSuccessUrl=`${e}/sso/recover/${t}/success`,this.expectedErrorUrl=`${e}/sso/recover/error`,this.resolvePromise=null,this.rejectPromise=null,this.verifyPopup=this.verifyPopup.bind(this),this.handlePopupVerification=this.handlePopupVerification.bind(this),this.processSuccessUrl=this.processSuccessUrl.bind(this),this.processErrorUrl=this.processErrorUrl.bind(this)}getSsoTokenFromThirdParty(e){return this.popup=window.open(void 0,"__blank","popup,width=380,height=600"),this.popup.opener=null,this.popup.location.href=e.toString(),new Promise(this.handlePopupVerification)}handlePopupVerification(e,t){this.resolvePromise=e,this.rejectPromise=t,this.intervalCheck=setInterval(this.verifyPopup,200)}verifyPopup(){if(!this.popup||this.popup?.closed)return this.rejectPromise(new Error("The user navigated away from the tab where the SSO sign-in initiated")),void this.close();let e=null;try{e=this.popup.location.href}catch(e){return void console.error(e)}e.startsWith(this.expectedSuccessUrl)?this.processSuccessUrl(e):e.startsWith(this.expectedErrorUrl)&&this.processErrorUrl(e)}processSuccessUrl(e){const t=new URL(e).searchParams.get("token");var r;r=t,new(B())(Ie).test(r)&&(this.resolvePromise({case:Oe,token:t}),this.close())}processErrorUrl(e){const t=new URL(e).searchParams.get("email");var r;r=t,new(B())("^[\\p{L}0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\\p{L}0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[_\\p{L}0-9][-_\\p{L}0-9]*\\.)*(?:[\\p{L}0-9][-\\p{L}0-9]{0,62})\\.(?:(?:[a-z]{2}\\.)?[a-z]{2,})$").test(r)&&(this.resolvePromise({case:Ae,email:t}),this.close())}close(){this.rejectPromise=null,this.resolvePromise=null,this.popup?.close(),this.popup=null,clearInterval(this.intervalCheck)}},Le=class{constructor(e,t,r,s){this.providerId=e,this.apiClientOptions=t.getApiClientOptions();const n=t.trustedDomain.replace(/\/$/,"");this.getUrlForSsoIdentificationService=new Re(t.getApiClientOptions()),this.getRecoverUrlService=new le(n,t.getApiClientOptions()),this.ssoPopupHandler=new Ue(n,e),this.successCallback=r,this.registrationRequiredCallback=s}async exec(){const e=await this.getUrlForSsoIdentificationService.getUrl(this.providerId),t=await this.ssoPopupHandler.getSsoTokenFromThirdParty(e);if(t.case===Oe){const e=await this.getRecoverUrlService.getRecoverUrl(t.token);this.successCallback(e.toString())}else t.case===Ae&&this.registrationRequiredCallback(t.email)}stopProcess(){this.ssoPopupHandler.close()}};class ke extends s.Component{constructor(e){super(e),this.state=this.defaultState,this.bindEventHandlers(),this.identifyViaSsoService=new Le(this.props.ssoProvider.id,this.props.context,this.handleSsoAuthSuccess,this.handleSsoAuthSuccessForRegistration)}get defaultState(){return{processing:!1}}componentDidMount(){window.addEventListener("beforeunload",this.handleBeforeUnload)}componentWillUnmount(){this.handleBeforeUnload()}handleBeforeUnload(){this.identifyViaSsoService.stopProcess(),window.removeEventListener("beforeunload",this.handleBeforeUnload)}bindEventHandlers(){this.handleBeforeUnload=this.handleBeforeUnload.bind(this),this.handleSsoRecoverClick=this.handleSsoRecoverClick.bind(this),this.handleGoToEmailClick=this.handleGoToEmailClick.bind(this),this.handleSsoAuthSuccess=this.handleSsoAuthSuccess.bind(this),this.handleSsoAuthSuccessForRegistration=this.handleSsoAuthSuccessForRegistration.bind(this)}async handleSsoRecoverClick(){if(!this.state.processing){this.toggleProcessing();try{await this.identifyViaSsoService.exec()}catch(e){}this.toggleProcessing()}}handleSsoAuthSuccess(e){window.location.href=e}handleSsoAuthSuccessForRegistration(e){this.props.onUserRegistrationRequired(e)}handleGoToEmailClick(){this.identifyViaSsoService.stopProcess(),this.props.onSecondaryActionClick()}toggleProcessing(){const e=this.state.processing;this.setState({processing:!e})}isProcessing(){return this.state.processing}render(){const e=this.props.ssoProvider;if(!e)return null;const t=this.isProcessing(),r=t?"disabled":"";return s.createElement("div",{className:"enter-username"},s.createElement("h1",null,s.createElement(A.x6,null,"Welcome back!")),s.createElement("p",null,s.createElement(A.x6,null,"Your browser is not configured to work with this passbolt instance.")," ",s.createElement(A.x6,null,"Please authenticate with the Single Sign-On provider to continue.")),s.createElement("div",{className:"sso-login-form form-actions"},s.createElement("button",{type:"button",className:`sso-login-button ${r} ${e.id}`,onClick:this.handleSsoRecoverClick,disabled:t},s.createElement("span",{className:"provider-logo"},e.icon),this.props.t("Sign in with {{providerName}}",{providerName:e.name})),s.createElement("button",{type:"button",className:"link",onClick:this.handleGoToEmailClick},s.createElement(A.x6,null,"Continue with my email."))))}}ke.propTypes={ssoProvider:d().object,onSecondaryActionClick:d().func,onUserRegistrationRequired:d().func,context:d().any,t:d().func};const Ne=o((0,A.CI)("common")(ke));class _e extends s.Component{componentDidMount(){this.initializeTriage(),this.getSsoProviderData=this.getSsoProviderData.bind(this)}initializeTriage(){setTimeout(this.props.apiTriageContext.onInitializeTriageRequested,1e3)}getSsoProviderData(){const e=this.props.apiTriageContext.getSsoProviderId();return w.find((t=>t.id===e))}render(){switch(this.props.apiTriageContext.state){case R.USERNAME_STATE:return s.createElement(W,{isSsoRecoverEnabled:this.props.apiTriageContext.isSsoRecoverEnabled,onSecondaryActionClick:this.props.apiTriageContext.handleSwitchToSsoSignInState});case R.SSO_SIGN_IN_STATE:return s.createElement(Ne,{ssoProvider:this.getSsoProviderData(),onSecondaryActionClick:this.props.apiTriageContext.handleSwitchToUsernameState,onUserRegistrationRequired:this.props.apiTriageContext.handleSwitchToEnterNameState});case R.CHECK_MAILBOX_STATE:return s.createElement(X,null);case R.NAME_STATE:return s.createElement(Z,null);case R.USERNAME_NOT_FOUND_ERROR:return s.createElement(Q,null);case R.UNEXPECTED_ERROR_STATE:return s.createElement(oe,{error:this.props.apiTriageContext.unexpectedError});default:return s.createElement(N,null)}}}_e.propTypes={apiTriageContext:d().object};const De=P(_e);var Ve;function $e(){return $e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},$e.apply(null,arguments)}const Fe=function(e){return s.createElement("svg",$e({xmlns:"http://www.w3.org/2000/svg",width:17,height:16,fill:"none",viewBox:"0 0 17 16"},e),Ve||(Ve=s.createElement("g",{clipPath:"url(#heart_svg__clip0_93_734678)"},s.createElement("path",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13.497 9.333c.993-.973 2-2.14 2-3.666A3.667 3.667 0 0 0 11.83 2c-1.173 0-2 .333-3 1.333-1-1-1.827-1.333-3-1.333a3.667 3.667 0 0 0-3.667 3.667c0 1.533 1 2.7 2 3.666L8.83 14z"}))))};class je extends s.Component{render(){return s.createElement("div",{className:"tooltip",tabIndex:"0"},this.props.children,s.createElement("span",{className:`tooltip-text ${this.props.direction}`},this.props.message))}}je.defaultProps={direction:"right"},je.propTypes={children:d().any,message:d().any.isRequired,direction:d().string};const Me=je;class Be extends s.Component{get privacyUrl(){return this.props.context.siteSettings.privacyLink}get creditsUrl(){return"https://www.passbolt.com/credits"}get unsafeUrl(){return"https://www.passbolt.com/docs/hosting/faq/why-I-see-unsafe-mode-banner/"}get termsUrl(){return this.props.context.siteSettings.termsLink}get versions(){const e=[],t=this.props.context.siteSettings.version;return t&&e.push(`${this.props.t("Server")} ${t}`),this.props.context.extensionVersion&&e.push(`${this.props.t("Client")} ${this.props.context.extensionVersion}`),e.join(" / ")}get isUnsafeMode(){if(!this.props.context.siteSettings)return!1;const e=this.props.context.siteSettings.debug,t=this.props.context.siteSettings.url.startsWith("http://");return e||t}render(){return s.createElement("footer",{className:"footer"},s.createElement("ul",{className:"footer-links"},this.isUnsafeMode&&s.createElement("li",{className:"error-message"},s.createElement("a",{href:this.unsafeUrl,target:"_blank",rel:"noopener noreferrer"},s.createElement(A.x6,null,"Unsafe mode"))),this.termsUrl&&s.createElement("li",null,s.createElement("a",{href:this.termsUrl,target:"_blank",rel:"noopener noreferrer"},s.createElement(A.x6,null,"Terms"))),this.privacyUrl&&s.createElement("li",null,s.createElement("a",{href:this.privacyUrl,target:"_blank",rel:"noopener noreferrer"},s.createElement(A.x6,null,"Privacy"))),s.createElement("li",null,s.createElement("a",{href:this.creditsUrl,target:"_blank",rel:"noopener noreferrer"},s.createElement(A.x6,null,"Credits"))),s.createElement("li",null,this.versions&&s.createElement(Me,{message:this.versions,direction:"left"},s.createElement("a",{className:"button button-transparent inline",href:this.creditsUrl,target:"_blank",rel:"noopener noreferrer"},s.createElement(Fe,null))),!this.versions&&s.createElement("a",{className:"button button-transparent inline",href:this.creditsUrl,target:"_blank",rel:"noopener noreferrer"},s.createElement(Fe,null)))))}}Be.propTypes={context:d().any,t:d().func};const qe=o((0,A.CI)("common")(Be));var He=r(2635),ze=r(1347);class Ke extends s.Component{constructor(e){super(e),this.state=this.defaultState}get defaultState(){return{ready:!1}}async componentDidMount(){await He.Ay.use(A.r9).use(ze.A).init({lng:this.locale,load:"currentOnly",interpolation:{escapeValue:!1},react:{useSuspense:!1},backend:{loadPath:this.props.loadingPath||"/locales/{{lng}}/{{ns}}.json"},supportedLngs:this.supportedLocales,fallbackLng:!1,ns:["common"],defaultNS:"common",keySeparator:!1,nsSeparator:!1,debug:!1}),this.setState({ready:!0})}get supportedLocales(){return this.props.context.siteSettings?.supportedLocales?this.props.context.siteSettings?.supportedLocales.map((e=>e.locale)):[this.locale]}get locale(){return this.props.context.locale}async componentDidUpdate(e){await this.handleLocaleChange(e.context.locale)}async handleLocaleChange(e){this.locale!==e&&await He.Ay.changeLanguage(this.locale)}get isReady(){return this.state.ready}render(){return s.createElement(s.Fragment,null,this.isReady&&this.props.children)}}Ke.propTypes={context:d().any,loadingPath:d().any,children:d().any};const We=o(Ke),Ge=new class{allPropTypes=(...e)=>(...t)=>{const r=e.map((e=>e(...t))).filter(Boolean);if(0===r.length)return;const s=r.map((e=>e.message)).join("\n");return new Error(s)}};var Ze;function Je(){return Je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Je.apply(null,arguments)}const Xe=function(e){return s.createElement("svg",Je({width:25,height:24,fill:"none",viewBox:"0 0 25 24"},e),Ze||(Ze=s.createElement("path",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11.597 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16M21.597 21l-4.35-4.35"})))};class Ye extends s.Component{constructor(e){super(e),this.state=this.getDefaultState(e),this.bindCallback(),this.createRefs()}getDefaultState(e){return{selectedValue:e.value,search:"",open:!1,style:void 0}}get listItemsFiltered(){const e=this.props.items.filter((e=>e.value!==this.state.selectedValue));return this.props.search&&""!==this.state.search?this.getItemsMatch(e,this.state.search):e}get selectedItemLabel(){const e=this.props.items&&this.props.items.find((e=>e.value===this.state.selectedValue));return e&&e.label||s.createElement(s.Fragment,null,"")}static getDerivedStateFromProps(e,t){return void 0!==e.value&&e.value!==t.selectedValue?{selectedValue:e.value}:null}bindCallback(){this.handleDocumentClickEvent=this.handleDocumentClickEvent.bind(this),this.handleDocumentContextualMenuEvent=this.handleDocumentContextualMenuEvent.bind(this),this.handleDocumentDragStartEvent=this.handleDocumentDragStartEvent.bind(this),this.handleDocumentScrollEvent=this.handleDocumentScrollEvent.bind(this),this.handleSelectClick=this.handleSelectClick.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleItemClick=this.handleItemClick.bind(this),this.handleSelectKeyDown=this.handleSelectKeyDown.bind(this),this.handleItemKeyDown=this.handleItemKeyDown.bind(this),this.handleBlur=this.handleBlur.bind(this)}createRefs(){this.selectedItemRef=s.createRef(),this.selectItemsRef=s.createRef(),this.itemsRef=s.createRef()}componentDidMount(){document.addEventListener("click",this.handleDocumentClickEvent,{capture:!0}),document.addEventListener("contextmenu",this.handleDocumentContextualMenuEvent,{capture:!0}),document.addEventListener("dragstart",this.handleDocumentDragStartEvent,{capture:!0}),document.addEventListener("scroll",this.handleDocumentScrollEvent,{capture:!0})}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClickEvent,{capture:!0}),document.removeEventListener("contextmenu",this.handleDocumentContextualMenuEvent,{capture:!0}),document.removeEventListener("dragstart",this.handleDocumentDragStartEvent,{capture:!0}),document.removeEventListener("scroll",this.handleDocumentScrollEvent,{capture:!0})}handleDocumentClickEvent(e){this.selectedItemRef.current.contains(e.target)||this.selectItemsRef.current.contains(e.target)||this.closeSelect()}handleDocumentContextualMenuEvent(e){this.selectedItemRef.current.contains(e.target)||this.selectItemsRef.current.contains(e.target)||this.closeSelect()}handleDocumentDragStartEvent(){this.closeSelect()}handleDocumentScrollEvent(e){this.itemsRef.current.contains(e.target)||this.selectItemsRef.current.contains(e.target)||this.closeSelect()}handleSelectClick(){if(this.props.disabled)this.closeSelect();else{const e=!this.state.open;e?this.forceVisibilitySelect():this.resetStyleSelect(),this.setState({open:e})}}getFirstParentWithTransform(){let e=this.selectedItemRef.current.parentElement;for(;null!==e&&""===e.style.getPropertyValue("transform");)e=e.parentElement;return e}forceVisibilitySelect(){const e=this.selectedItemRef.current.getBoundingClientRect(),{width:t,height:r}=e;let{top:s,left:n}=e;const i=this.getFirstParentWithTransform();if(i){const e=i.getBoundingClientRect();s-=e.top,n-=e.left}const a={position:"fixed",zIndex:1,width:t,height:r,top:s,left:n};this.setState({style:a})}handleBlur(e){e.currentTarget.contains(e.relatedTarget)||this.closeSelect()}closeSelect(){this.resetStyleSelect(),this.setState({open:!1})}resetStyleSelect(){this.setState({style:void 0})}handleInputChange(e){const t=e.target,r=t.value,s=t.name;this.setState({[s]:r})}handleItemClick(e){if(this.setState({selectedValue:e.value,open:!1}),"function"==typeof this.props.onChange){const t={target:{value:e.value,name:this.props.name}};this.props.onChange(t)}this.closeSelect()}getItemsMatch(e,t){const r=t&&t.split(/\s+/)||[""];return e.filter((e=>r.every((t=>((e,t)=>(e=>new RegExp((e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))(e),"i"))(e).test(t))(t,e.label)))))}handleSelectKeyDown(e){switch(e.keyCode){case 13:return e.stopPropagation(),void this.handleSelectClick();case 40:return e.preventDefault(),e.stopPropagation(),void(this.state.open?this.focusItem(0):this.handleSelectClick());case 38:return e.preventDefault(),e.stopPropagation(),void(this.state.open?this.focusItem(this.listItemsFiltered.length-1):this.handleSelectClick());case 27:return e.stopPropagation(),void this.closeSelect();default:return}}focusItem(e){this.itemsRef.current.childNodes[e]?.focus()}handleItemKeyDown(e,t){switch(e.keyCode){case 13:return e.stopPropagation(),void this.handleItemClick(t);case 40:return e.stopPropagation(),e.preventDefault(),void(e.target.nextSibling?e.target.nextSibling.focus():this.focusItem(0));case 38:return e.stopPropagation(),e.preventDefault(),void(e.target.previousSibling?e.target.previousSibling.focus():this.focusItem(this.listItemsFiltered.length-1));default:return}}hasFilteredItems(){return this.listItemsFiltered.length>0}render(){return s.createElement("div",{className:`select-container ${this.props.className}`,style:{width:this.state.style?.width,height:this.state.style?.height}},s.createElement("div",{onKeyDown:this.handleSelectKeyDown,onBlur:this.handleBlur,id:this.props.id,className:`select ${this.props.direction} ${this.state.open?"open":""}`,style:this.state.style},s.createElement("div",{ref:this.selectedItemRef,className:"selected-value "+(this.props.disabled?"disabled":""),tabIndex:this.props.disabled?-1:0,onClick:this.handleSelectClick},s.createElement("span",{className:"value"},this.selectedItemLabel),s.createElement(re,null)),s.createElement("div",{ref:this.selectItemsRef,className:"select-items "+(this.state.open?"visible":"")},this.props.search&&s.createElement(s.Fragment,null,s.createElement("input",{className:"search-input",name:"search",value:this.state.search,onChange:this.handleInputChange,type:"text"}),s.createElement(Xe,{className:"search"})),s.createElement("ul",{ref:this.itemsRef,className:"items"},this.hasFilteredItems()&&this.listItemsFiltered.map((e=>s.createElement("li",{tabIndex:e.disabled?-1:0,key:e.value,className:`option ${e.value}`,onKeyDown:t=>this.handleItemKeyDown(t,e),onClick:()=>this.handleItemClick(e)},e.label))),!this.hasFilteredItems()&&this.props.search&&s.createElement("li",{className:"option no-results"},s.createElement(A.x6,null,"No results match")," ",s.createElement("span",null,this.state.search))))))}}Ye.defaultProps={id:"",name:"select",className:"",direction:"bottom"},Ye.propTypes={id:d().string,name:d().string,className:d().string,direction:d().oneOf(Object.values({top:"top",bottom:"bottom",left:"left",right:"right"})),search:d().bool,items:d().array,value:Ge.allPropTypes(d().oneOfType([d().string,d().number,d().bool]),((e,t,r)=>{const s=e[t],n=e.items;if(null!==s&&n.length>0&&n.every((e=>e.value!==s)))return new Error(`Invalid prop ${t} passed to ${r}. Expected the value ${s} in items.`)})),disabled:d().bool,onChange:d().func};const Qe=(0,A.CI)("common")(Ye);class et extends s.Component{constructor(e){super(e),this.state=this.defaultState,this.bindHandlers()}async componentDidMount(){await this.initLocale()}async componentDidUpdate(e){await this.handleLocaleChange(e.context.locale)}async handleLocaleChange(e){this.props.context.locale!==e&&await this.setState({locale:this.props.context.locale})}get defaultState(){return{loading:!0,locale:null,processing:!1}}get areActionsAllowed(){return!this.state.processing}bindHandlers(){this.handleLocaleInputChange=this.handleLocaleInputChange.bind(this)}async handleLocaleInputChange(e){const t=e.target.value;await this.updateLocale(t)}async updateLocale(e){await this.toggleProcessing(),await this.props.context.onUpdateLocaleRequested(e),await this.toggleProcessing()}async initLocale(){await this.setState({locale:this.props.context.locale,loading:!1})}async toggleProcessing(){const e=this.state.processing;return this.setState({processing:!e})}isLoading(){return this.state.loading}get supportedLocales(){return this.props.context.siteSettings.supportedLocales?this.props.context.siteSettings.supportedLocales.map((e=>({value:e.locale,label:e.label}))):[]}render(){return s.createElement(s.Fragment,null,!this.isLoading()&&s.createElement("div",{className:"select-wrapper input"},s.createElement(Qe,{id:"user-locale-input",className:"setup-extension",name:"locale",value:this.state.locale,disabled:!this.areActionsAllowed,items:this.supportedLocales,onChange:this.handleLocaleInputChange})))}}et.propTypes={context:d().any};const tt=o(et);class rt extends s.Component{get statesToHideLocaleSwitch(){return[R.INITIAL_STATE]}get mustDisplayLocaleSwitch(){return!this.statesToHideLocaleSwitch.includes(this.props.apiTriageContext.state)}render(){return s.createElement(s.Fragment,null,this.mustDisplayLocaleSwitch&&s.createElement(tt,null))}}rt.propTypes={apiTriageContext:d().any};const st=P(rt);var nt,it,at,ot,lt;function ct(){return ct=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ct.apply(null,arguments)}const ht=function(e){return s.createElement("svg",ct({xmlns:"http://www.w3.org/2000/svg",width:151,height:27,fill:"none","aria-labelledby":"logo-title logo-description",viewBox:"0 0 151 27"},e),nt||(nt=s.createElement("title",{id:"logo-title"},"Passbolt logo")),it||(it=s.createElement("desc",{id:"logo-description"},"This is the logo of passbolt.")),at||(at=s.createElement("path",{fill:"var(--icon-color)",d:"M4.648 9.234v8.607h2.48c1.646 0 2.786-.349 3.47-1.012.685-.664 1.013-1.823 1.013-3.395 0-1.52-.305-2.595-.938-3.218-.633-.673-1.695-.972-3.24-.972zM.597 5.963h7.797c2.357 0 4.178.676 5.496 2.048q1.976 2.058 1.974 5.689a8.6 8.6 0 0 1-.406 2.749 7.1 7.1 0 0 1-1.24 2.278 5.9 5.9 0 0 1-2.38 1.773c-.937.349-2.152.524-3.697.524H4.648V26.5H.597zM24.016 18.016h5.064v-3.119h-4.76c-.937 0-1.594.124-1.95.375-.357.25-.517.698-.517 1.321 0 .524.15.899.429 1.122.28.223.848.301 1.734.301M18.649 5.963h8.268c2.103 0 3.672.476 4.736 1.423 1.065.947 1.594 2.347 1.594 4.217v9.456H22.37c-1.52 0-2.708-.375-3.52-1.121-.81-.747-1.2-1.823-1.2-3.22 0-1.722.454-2.945 1.392-3.692s2.483-1.134 4.697-1.134h5.315v-.365c0-.898-.276-1.518-.809-1.896-.532-.377-1.47-.55-2.86-.55H18.65zM36.55 17.915h8.525c.76 0 1.318-.124 1.646-.35.183-.122.328-.29.423-.486.094-.197.134-.414.115-.63a1.2 1.2 0 0 0-.112-.632 1.24 1.24 0 0 0-.42-.492c-.355-.253-.91-.374-1.646-.374h-3.494c-2.067 0-3.467-.325-4.203-.947-.737-.623-1.088-1.747-1.088-3.32 0-1.62.431-2.82 1.318-3.592.886-.772 2.255-1.152 4.064-1.152h8.684v3.142h-7.134q-1.75 0-2.279.301c-.354.198-.532.547-.532 1.071-.017.193.016.387.096.564s.204.332.361.449c.302.223.809.324 1.468.324h3.676c1.672 0 2.961.397 3.824 1.172s1.315 1.871 1.315 3.32c0 1.397-.405 2.53-1.188 3.417-.37.427-.833.768-1.354.996-.522.23-1.09.34-1.661.325H36.549zM53.822 17.915h8.526c.76 0 1.318-.124 1.646-.35a1.23 1.23 0 0 0 .42-.487c.093-.196.132-.413.112-.629a1.2 1.2 0 0 0-.111-.632 1.24 1.24 0 0 0-.421-.492c-.354-.253-.91-.374-1.646-.374h-3.493c-2.067 0-3.467-.325-4.204-.947-.736-.623-1.088-1.752-1.088-3.324 0-1.62.432-2.82 1.318-3.593.886-.772 2.253-1.147 4.075-1.147h8.686v3.142h-7.141q-1.747 0-2.28.301c-.353.198-.531.547-.531 1.071-.017.193.016.387.096.564s.204.332.361.449c.302.223.809.324 1.468.324h3.671c1.672 0 2.963.397 3.824 1.172s1.315 1.871 1.315 3.32c0 1.397-.403 2.53-1.188 3.417-.37.427-.832.767-1.354.996a3.9 3.9 0 0 1-1.66.325H53.769v-3.106zM75.387.5v5.463h3.47c1.55 0 2.759.175 3.694.55.946.362 1.77.976 2.38 1.772a7.2 7.2 0 0 1 1.243 2.296c.281.888.417 1.814.403 2.744q0 3.63-1.974 5.689c-1.315 1.372-3.14 2.046-5.493 2.046h-7.8V.5zm2.462 8.734h-2.483v8.608h2.785c1.55 0 2.633-.324 3.243-.95s.935-1.721.935-3.268-.354-2.694-1.033-3.367c-.68-.673-1.832-1.023-3.447-1.023M92.3 13.525c0 1.445.328 2.532 1.013 3.367s1.62 1.198 2.86 1.198 2.152-.398 2.863-1.198 1.033-1.921 1.033-3.367-.356-2.547-1.033-3.344c-.677-.798-1.62-1.198-2.863-1.198a3.64 3.64 0 0 0-1.57.279 3.6 3.6 0 0 0-1.29.919c-.685.797-1.013 1.921-1.013 3.344m12.002 0q0 3.544-2.202 5.689c-1.47 1.397-3.42 2.121-5.901 2.121s-4.457-.699-5.924-2.121-2.202-3.292-2.202-5.664q0-3.558 2.202-5.69c1.467-1.424 3.444-2.145 5.919-2.145s4.431.724 5.901 2.144 2.207 3.294 2.207 5.666M110.935 21.06h-4.202V.5h4.202zM112.884 5.963h2.86V.5h4.052v5.463h4.278v3.02h-4.278v6.09c0 1.12.204 1.895.581 2.343.377.449 1.064.649 2.026.649h1.671v3.02h-3.72c-1.494 0-2.636-.4-3.444-1.223-.809-.823-1.189-1.995-1.189-3.519v-7.36h-2.863v-3.02z"})),ot||(ot=s.createElement("path",{fill:"#D40101",d:"m149.951 10.68-9.059-8.36a2.12 2.12 0 0 0-1.421-.543c-.526 0-1.033.194-1.421.544l-5.684 5.268c.745.271 1.414.71 1.952 1.282.539.572.933 1.26 1.149 2.01h7.673a.73.73 0 0 1 .504.204.69.69 0 0 1 .207.494v1.147a.68.68 0 0 1-.207.494.72.72 0 0 1-.504.204h-.886v1.623a.68.68 0 0 1-.205.494.72.72 0 0 1-.503.205h-1.945a.73.73 0 0 1-.503-.205.69.69 0 0 1-.205-.494v-1.623h-3.426a4.84 4.84 0 0 1-1.135 2.033 5 5 0 0 1-1.966 1.287l5.71 5.276c.388.349.895.543 1.421.543a2.12 2.12 0 0 0 1.421-.543l9.043-8.355a2.03 2.03 0 0 0-.01-2.985"})),lt||(lt=s.createElement("path",{fill:"#D40101",d:"M130.683 9.867a2.6 2.6 0 0 0-1.064.253c-.371.18-.686.455-.913.794a2.242 2.242 0 0 0-.113 2.305 2.3 2.3 0 0 0 .831.877 2.36 2.36 0 0 0 2.355.059c.362-.197.664-.484.875-.833a2.24 2.24 0 0 0 .324-1.153 2.21 2.21 0 0 0-.653-1.625 2.3 2.3 0 0 0-.751-.5 2.3 2.3 0 0 0-.891-.177"})))};class dt extends s.Component{constructor(e){super(e),this.state=this.defaultState}get defaultState(){return{siteSettings:null,trustedDomain:this.baseUrl,getApiClientOptions:this.getApiClientOptions.bind(this),locale:null,onUpdateLocaleRequested:this.onUpdateLocaleRequested.bind(this)}}async componentDidMount(){await this.getSiteSettings(),this.initLocale()}get baseUrl(){const e=document.getElementsByTagName("base")&&document.getElementsByTagName("base")[0];return e?e.attributes.href.value.replace(/\/*$/g,""):(console.error("Unable to retrieve the page base tag"),"")}getApiClientOptions(){return(new c).setBaseUrl(this.state.trustedDomain)}async getSiteSettings(){const e=this.getApiClientOptions().setResourceName("settings"),t=new v(e),{body:r}=await t.findAll(),s=new j(r);await this.setState({siteSettings:s})}initLocale(){const e=this.getUrlLocale()||this.getBrowserLocale()||this.getBrowserSimilarLocale()||this.state.siteSettings.locale;this.setState({locale:e}),this.setUrlLocale(e)}getUrlLocale(){const e=new URL(window.location.href).searchParams.get("locale");if(e){const t=this.state.siteSettings.supportedLocales.find((t=>e===t.locale));if(t)return t.locale}}getBrowserLocale(){const e=this.state.siteSettings.supportedLocales.find((e=>navigator.language===e.locale));if(e)return e.locale}getBrowserSimilarLocale(){const e=navigator.language.split("-")[0],t=this.state.siteSettings.supportedLocales.find((t=>e===t.locale.split("-")[0]));if(t)return t.locale}async onUpdateLocaleRequested(e){await this.setState({locale:e}),this.setUrlLocale(e)}setUrlLocale(e){const t=new URL(window.location.href);t.searchParams.set("locale",e),window.history.replaceState(null,null,t)}isReady(){return null!==this.state.siteSettings&&null!==this.state.locale}render(){return s.createElement(l.Provider,{value:this.state},this.isReady()&&s.createElement(We,{loadingPath:`${this.state.trustedDomain}/locales/{{lng}}/{{ns}}.json`},s.createElement(x,null,s.createElement("div",{id:"container",className:"container page login"},s.createElement("div",{className:"content"},s.createElement("div",{className:"header"},s.createElement("div",{className:"logo-svg"},s.createElement(ht,{role:"img",width:"20rem",height:"3.5rem"}))),s.createElement("div",{className:"login-form"},s.createElement(De,null)),s.createElement(st,null)),s.createElement(qe,null)))))}}const pt=dt,ut=document.createElement("div");document.body.appendChild(ut),n.render(s.createElement(pt,null),ut)}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return s[e].call(r.exports,r,r.exports,i),r.exports}i.m=s,e=[],i.O=(t,r,s,n)=>{if(!r){var a=1/0;for(h=0;h<e.length;h++){for(var[r,s,n]=e[h],o=!0,l=0;l<r.length;l++)(!1&n||a>=n)&&Object.keys(i.O).every((e=>i.O[e](r[l])))?r.splice(l--,1):(o=!1,n<a&&(a=n));if(o){e.splice(h--,1);var c=s();void 0!==c&&(t=c)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[r,s,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},r=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,s){if(1&s&&(e=this(e)),8&s)return e;if("object"==typeof e&&e){if(4&s&&e.__esModule)return e;if(16&s&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var a={};t=t||[null,r({}),r([]),r(r)];for(var o=2&s&&e;"object"==typeof o&&!~t.indexOf(o);o=r(o))Object.getOwnPropertyNames(o).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,i.d(n,a),n},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=666,(()=>{var e={666:0};i.O.j=t=>0===e[t];var t=(t,r)=>{var s,n,[a,o,l]=r,c=0;if(a.some((t=>0!==e[t]))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(l)var h=l(i)}for(t&&t(r);c<a.length;c++)n=a[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(h)},r=self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var a=i.O(void 0,[847],(()=>i(4029)));a=i.O(a)})();